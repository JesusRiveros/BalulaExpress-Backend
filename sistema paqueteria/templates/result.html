<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resultado del Envío</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #d1e0ff;
        }
        .logo {
            width: 150px;
            height: auto;
        }
        .card-section {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: left;
        }
        #map {
            height: 300px;
            width: 100%;
            border-radius: 10px;
        }
        h4 {
            margin-top: 20px;
            margin-bottom: 15px;
        }
        .divider {
            border-top: 1px solid #ddd;
            margin: 25px 0;
        }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="text-center mb-4">
        <img src="{{ url_for('static', filename='Balula logo.png') }}" class="logo" alt="Logo de la Empresa">
        <h1 class="mb-4">Resumen del Envío</h1>
    </div>

    {% include 'partials/stepper.html' %}

    <div class="card-section">
        <h4><i class="fas fa-truck me-2"></i>Datos del envío</h4>
        <p><strong><i class="fas fa-map-marker-alt me-2 text-danger"></i>Origen:</strong> {{ origin }}</p>
        <p><strong><i class="fas fa-map-pin me-2 text-primary"></i>Destino:</strong> {{ destination }}</p>
        <p><strong><i class="fas fa-hand-holding-box me-2 text-success"></i>Tipo de entrega:</strong>
            {% if tipo_entrega == "recolector" %}
                Recolector a domicilio
            {% elif tipo_entrega == "centro_autorizado" %}
                Centro autorizado
            {% else %}
                No especificado
            {% endif %}
        </p>
        <p><strong><i class="fas fa-envelope me-2 text-secondary"></i>Correo del destinatario:</strong> {{ email }}</p>
        <p><strong><i class="fas fa-road me-2 text-info"></i>Distancia estimada:</strong> {{ distance_km }} km</p>
        <p><strong><i class="fas fa-calendar-alt me-2 text-warning"></i>Fecha Estimada de Entrega:</strong> {{ delivery_date }}</p>
    </div>

    <div class="card-section">
        <h4><i class="fas fa-file-invoice-dollar me-2"></i>Desglose de costos</h4>
        <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between">
                <span><i class="fas fa-money-bill-wave me-2 text-secondary"></i> Costo base</span>
                <span>$40</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
                <span><i class="fas fa-weight-hanging me-2 text-primary"></i> Peso ({{ weight }} kg) × $20</span>
                <span>${{ weight * 20 | round(2) }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
                <span><i class="fas fa-cube me-2 text-warning"></i> Volumen ({{ length }}x{{ width }}x{{ height }} cm) × $0.005</span>
                <span>${{ (length * width * height * 0.005) | round(2) }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
                <span><i class="fas fa-road me-2 text-info"></i> Distancia ({{ distance_km }} km) × $3</span>
                <span>${{ (distance_km * 3) | round(2) }}</span>
            </li>
            {% if box_choice %}
            <li class="list-group-item d-flex justify-content-between">
                <span><i class="fas fa-box-open me-2 text-success"></i> Caja seleccionada</span>
                <span>
                    {% if box_choice == 'small' %} $10
                    {% elif box_choice == 'books' %} $15
                    {% elif box_choice == 'shoes' %} $25
                    {% elif box_choice == 'move' %} $40
                    {% else %} $0
                    {% endif %}
                </span>
            </li>
            {% endif %}
            {% if shipping_type == 'fast' %}
            <li class="list-group-item d-flex justify-content-between">
                <span><i class="fas fa-bolt me-2 text-danger"></i> Envío exprés</span>
                <span>$20</span>
            </li>
            {% endif %}
            {% if compensated %}
            <li class="list-group-item d-flex justify-content-between">
                <span><i class="fas fa-leaf me-2 text-success"></i> Compensación CO₂</span>
                <span>$5</span>
            </li>
            {% endif %}
            <li class="list-group-item d-flex justify-content-between fw-bold">
                <span><i class="fas fa-dollar-sign me-2"></i> Total</span>
                <span>${{ cost }}</span>
            </li>
        </ul>
    </div>

    <div class="card-section">
        <h4><i class="fas fa-recycle me-2"></i>Detalles ecológicos</h4>
        <p><strong><i class="fas fa-box me-2"></i>Tipo de empaque:</strong> {{ eco_packaging }}</p>
        <p><strong><i class="fas fa-shipping-fast me-2"></i>Tipo de envío:</strong> {{ 'Rápido (1-2 días)' if shipping_type == 'fast' else 'Ecológico (3-5 días)' }}</p>

        {% if co2_emission > 0 %}
            <p><strong><i class="fas fa-cloud me-2 text-muted"></i>Huella de carbono estimada:</strong> {{ co2_emission }} kg de CO₂</p>
            {% if compensated %}
                <p class="text-success"><i class="fas fa-tree me-2"></i>Has compensado tu huella con una aportación para reforestar. ¡Gracias!</p>
            {% else %}
                <p class="text-danger"><i class="fas fa-times-circle me-2"></i>No se compensó la huella de carbono.</p>
            {% endif %}
        {% endif %}
    </div>

    <div class="card-section">
        <h4><i class="fas fa-map-marked-alt me-2"></i>Ubicación en el mapa</h4>
        <div id="map"></div>
    </div>

    <div class="text-center mt-4">
        <a href="/" class="btn btn-secondary me-2"><i class="fas fa-arrow-left me-1"></i> Calcular Otro Envío</a>
        <button onclick="window.print()" class="btn btn-info me-2"><i class="fas fa-print me-1"></i> Imprimir Cotización</button>
        <a href="{{ url_for('completar') }}" class="btn btn-success">Completar Información y Pagar</a>

    </div>
</div>

<script>
    function initMap() {
        const origin = "{{ origin }}";
        const destination = "{{ destination }}";

        const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 10,
            center: { lat: 19.4326, lng: -99.1332 }
        });

        const directionsService = new google.maps.DirectionsService();
        const directionsRenderer = new google.maps.DirectionsRenderer({ map: map });

        directionsService.route(
            {
                origin: origin,
                destination: destination,
                travelMode: google.maps.TravelMode.DRIVING
            },
            (response, status) => {
                if (status === "OK") {
                    directionsRenderer.setDirections(response);
                } else {
                    alert("Error al mostrar la ruta: " + status);
                }
            }
        );
    }
</script>
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAo9QR9HJwEH0zL-M9kdqFC1-TPULtzvWk&libraries=places&callback=initAutocomplete"
  async
  defer>
</script>
</body>
</html>
